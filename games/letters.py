import random
from games.base import BaseGame
from config import Config


class LettersGame(BaseGame):
    """لعبة الحروف - أجب عن الأسئلة التي تبدأ إجابتها بالحرف المطلوب"""

    def __init__(self, db, theme: str = "light"):
        super().__init__(db, theme)
        self.game_name = "حرف"
        
        # قاعدة بيانات الأسئلة لكل حرف (5 أسئلة لكل حرف)
        self.questions_db = {
            "أ": [
                {"q": "من هو أول نبي؟", "a": ["آدم", "ادم"]},
                {"q": "ما هي عاصمة اليونان؟", "a": ["أثينا", "اثينا"]},
                {"q": "ما هي عاصمة الجزائر؟", "a": ["الجزائر"]},
                {"q": "من هو أول خليفة للمسلمين؟", "a": ["أبو بكر", "ابو بكر", "ابوبكر", "أبوبكر"]},
                {"q": "ما هي أكبر قارة في العالم؟", "a": ["آسيا", "اسيا"]}
            ],
            "ب": [
                {"q": "ما هي عاصمة العراق؟", "a": ["بغداد"]},
                {"q": "ما هي عاصمة الصين؟", "a": ["بكين"]},
                {"q": "ما هي عاصمة لبنان؟", "a": ["بيروت"]},
                {"q": "ما هي عاصمة ألمانيا؟", "a": ["برلين"]},
                {"q": "ما الحيوان المعروف بتزويدنا بالحليب واللحم؟", "a": ["بقرة"]}
            ],
            "ت": [
                {"q": "ما هي عاصمة تونس؟", "a": ["تونس"]},
                {"q": "ما هي عاصمة تايوان؟", "a": ["تايبيه", "تايبي"]},
                {"q": "ما هي عاصمة جورجيا؟", "a": ["تبليسي"]},
                {"q": "ما الحيوان الضخم الذي يعيش في المستنقعات؟", "a": ["تمساح"]},
                {"q": "ما الفاكهة التي تأتي بألوان مختلفة كالأحمر والأخضر؟", "a": ["تفاح"]}
            ],
            "ث": [
                {"q": "ما الحيوان المعروف بلقب أبو الحصين؟", "a": ["ثعلب"]},
                {"q": "ما النبتة ذات الرائحة القوية التي تستخدم في الطبخ؟", "a": ["ثوم"]},
                {"q": "ما الكائن الزاحف الذي يطلق عليه اسم حية أو أفعى؟", "a": ["ثعبان"]},
                {"q": "ما اسم الجبل الذي احتمى فيه النبي محمد وأبو بكر أثناء الهجرة؟", "a": ["ثور"]},
                {"q": "ما اسم القوم الذين أرسل إليهم النبي صالح؟", "a": ["ثمود"]}
            ],
            "ج": [
                {"q": "ما هي عاصمة جيبوتي؟", "a": ["جيبوتي"]},
                {"q": "ما المدينة السعودية على البحر الأحمر وتعرفببوابة الحرمين؟", "a": ["جدة", "جده"]},
                {"q": "ما الحيوان المعروف بلقب سفينة الصحراء؟", "a": ["جمل"]},
                {"q": "من الصحابي الذي قاد المسلمين المهاجرين إلى الحبشة؟", "a": ["جعفر", "جعفر بن ابي طالب"]},
                {"q": "ما الجهاز المستخدم لقياس شدة التيار الكهربائي؟", "a": ["جلفانومتر", "جلفانوميتر"]}
            ],
            "ح": [
                {"q": "ما المدينة السورية المشهورة بقلعتها التاريخية وكبتها الحلبية؟", "a": ["حلب"]},
                {"q": "ما المدينة السورية التي يمر بها نهر العاصي وتشتهر بنواعيرها؟", "a": ["حماة", "حماه"]},
                {"q": "ما المدينة السعودية الواقعة في شمال المملكة وتعرف برالي السيارات السنوي؟", "a": ["حائل"]},
                {"q": "ما الركن الخامس من أركان الإسلام الذي يؤديه المسلمون في مكة؟", "a": ["حج"]},
                {"q": "ما الثدي العملاق الذي يتنفس الهواء ويعيش في المحيطات؟", "a": ["حوت"]}
            ],
            "خ": [
                {"q": "ما هي عاصمة السودان؟", "a": ["خرطوم", "الخرطوم"]},
                {"q": "ما المدينة السعودية الواقعة في المنطقة الشرقية وتعد من كبرى مدنها الصناعية؟", "a": ["خبر", "الخبر"]},
                {"q": "ما المعركة التي حفر فيها المسلمون خندقا حول المدينة المنورة؟", "a": ["خندق", "الخندق"]},
                {"q": "من الصحابي الملقب بسيف الله المسلول؟", "a": ["خالد", "خالد بن الوليد"]},
                {"q": "من الصحابية الشاعرة التي اشتهرت برثاء أخويها صخر ومعاوية؟", "a": ["خنساء", "الخنساء"]}
            ],
            "د": [
                {"q": "ما هي عاصمة أيرلندا؟", "a": ["دبلن"]},
                {"q": "ما هي عاصمة سوريا؟", "a": ["دمشق"]},
                {"q": "ما المدينة الإماراتية الشهيرة بناطحات السحاب؟", "a": ["دبي"]},
                {"q": "ما هي عاصمة قطر؟", "a": ["دوحة", "الدوحة"]},
                {"q": "ما الثدي الحيوان الذي يعيش في القطب الشمالي ويتميز بمعطفه الأبيض؟", "a": ["دب قطبي", "دب"]}
            ],
            "ذ": [
                {"q": "ما الحيوان المفترس الذي يلقب بأبي جعدة في التراث العربي؟", "a": ["ذئب"]},
                {"q": "ما المعدن الثمين الذي صنعت منه العملات والحلي عبر التاريخ؟", "a": ["ذهب"]},
                {"q": "ما الحبوب الصفراء التي تستخدم في صنع الدقيق والزيوت؟", "a": ["ذرة", "ذره"]},
                {"q": "ما الحشرة الطائرة التي تلوث الطعام وتنقل الجراثيم؟", "a": ["ذباب"]},
                {"q": "ما العملية العقلية التي يخزن فيها الإنسان معلوماته ويسترجعها؟", "a": ["ذاكرة", "ذاكره"]}
            ],
            "ر": [
                {"q": "ما هي عاصمة إيطاليا الشهيرة بمعالمها التاريخية؟", "a": ["روما"]},
                {"q": "ما الدولة الأكبر مساحة في العالم؟", "a": ["روسيا"]},
                {"q": "ما هي عاصمة آيسلندا؟", "a": ["ريكيافيك", "ريكيفيك"]},
                {"q": "ما اسم العملة الرسمية في دولة قطر؟", "a": ["ريال قطري", "ريال"]},
                {"q": "من ابنة الرسول صلى الله عليه وسلم التي تزوجها عثمان بن عفان؟", "a": ["رقية"]}
            ],
            "ز": [
                {"q": "ما هي عاصمة كرواتيا؟", "a": ["زغرب"]},
                {"q": "ما الدولة الإفريقية التي كانت تعرف باسم روديسيا الجنوبية في الماضي؟", "a": ["زيمبابوي"]},
                {"q": "ما الجزيرة التنزانية المشهورة بتوابلها؟", "a": ["زنجبار"]},
                {"q": "ما الكوكب السادس في ترتيب المجموعة الشمسية؟", "a": ["زحل"]},
                {"q": "ما الحيوان المعروف بطول عنقه ويعيش في المناطق العشبية بإفريقيا؟", "a": ["زرافة", "زرافه"]}
            ],
            "س": [
                {"q": "ما الحيوان الزاحف البطيء ذو الصدفة الصلبة؟", "a": ["سلحفاة", "سلحفاه"]},
                {"q": "من الصحابي الذي أشار بحفر الخندق في غزوة الأحزاب؟", "a": ["سلمان الفارسي", "سلمان"]},
                {"q": "ما هي عاصمة السويد؟", "a": ["ستوكهولم"]},
                {"q": "ما الحيوان الصغير الذي يعيش على الأشجار ويخزن الجوز لفصل الشتاء؟", "a": ["سنجاب"]},
                {"q": "ما الدولة العربية التي عاصمتها مسقط؟", "a": ["سلطنة عمان", "عمان"]}
            ],
            "ش": [
                {"q": "ما المدينة المصرية السياحية المطلة على البحر الأحمر؟", "a": ["شرم الشيخ"]},
                {"q": "ما الحيوان المفترس المعروف بالفهد الصياد ويتميز بسرعته الفائقة؟", "a": ["شيتا", "فهد"]},
                {"q": "ما إحدى الإمارات السبع في الإمارات وتعرف بعاصمة الثقافة؟", "a": ["شارقة", "الشارقة"]},
                {"q": "ما المدينة الصينية الكبرى الواقعة على ضفاف نهر هوانغبو؟", "a": ["شنغهاي"]},
                {"q": "ما الجهاز الإلكتروني الذي يعرض المحتوى المرئي كالصور والأفلام؟", "a": ["شاشة", "شاشه"]}
            ],
            "ص": [
                {"q": "ما هي عاصمة الجمهورية اليمنية؟", "a": ["صنعاء"]},
                {"q": "ما الطائر الجارح المعروف بحدة بصره وارتفاع تحليقه؟", "a": ["صقر"]},
                {"q": "ما النبات الصحراوي الشويك الذي يستخرج منه جل مفيد للبشرة؟", "a": ["صبار"]},
                {"q": "من القائد الإسلامي الذي حرر القدس بعد معركة حطين؟", "a": ["صلاح الدين", "صلاح الدين الأيوبي"]},
                {"q": "ما الفصل الذي ترتفع فيه درجات الحرارة في نصف الكرة الشمالي؟", "a": ["صيف"]}
            ],
            "ض": [
                {"q": "ما الحيوان البرمائي الذي يعيش في البرك ويصدر صوت النقيق؟", "a": ["ضفدع"]},
                {"q": "ما الرتبة التي يتولاها الشخص المسؤول عن حفظ الأمن في الجيش أو الشرطة؟", "a": ["ضابط"]},
                {"q": "ما السن الكبير الذي يظهر في مؤخرة الفم وقد يسبب آلاما؟", "a": ["ضرس العقل", "ضرس"]},
                {"q": "ما الصلاة النافلة التي تؤدى في الصباح بعد شروق الشمس وارتفاعها قليلا؟", "a": ["ضحى"]},
                {"q": "ما الحيوان المفترس من فصيلة الكلبيات ويعرف بصوته الذي يشبه القهقهة؟", "a": ["ضبع"]}
            ],
            "ط": [
                {"q": "ما الدولة الآسيوية الواقعة في وسط القارة وعاصمتها دوشنبه؟", "a": ["طاجيكستان"]},
                {"q": "ما الحيوان الجبلي المعروف بقرونه المعقوفة ويعيش في جبال عمان والإمارات؟", "a": ["طهر عربي", "طهر"]},
                {"q": "ما الأكلة المغربية الشهيرة التي تعد في وعاء فخاري وتتنوع مكوناتها؟", "a": ["طاجين"]},
                {"q": "ما الطائر الذي يزهو بذيله الملون الزخرفي ويعرف بجماله؟", "a": ["طاووس"]},
                {"q": "ما الشجرة الصحراوية المذكورة في القرآن الكريم في قوله تعالى وطلح منضود؟", "a": ["طلح"]}
            ],
            "ظ": [
                {"q": "ما الجور والتعدي على حقوق الآخرين دون وجه حق؟", "a": ["ظلم"]},
                {"q": "ما وقت الصلاة الذي يحل بعد زوال الشمس عن كبد السماء؟", "a": ["ظهر"]},
                {"q": "ما الغزال الجبلي الرشيق المعروف بقرونه الجميلة؟", "a": ["ظبي"]},
                {"q": "ما الشعور الذي يعبر عن العطش الشديد؟", "a": ["ظمأ", "ظما"]},
                {"q": "ما الجزء الصلب في طرف الأصابع الذي يقص باستمرار؟", "a": ["ظفر"]}
            ],
            "ع": [
                {"q": "ما المادة الحلوة التي ينتجها النحل؟", "a": ["عسل"]},
                {"q": "ما العضو في جسم الإنسان الذي يستخدم للرؤية؟", "a": ["عين"]},
                {"q": "ما هي عاصمة الأردن؟", "a": ["عمان"]},
                {"q": "ما القدرة على التفكير والتحليل لدى الإنسان؟", "a": ["عقل"]},
                {"q": "ما الفاكهة التي تزرع في كروم وتستخدم في صناعة النبيذ؟", "a": ["عنب"]}
            ],
            "غ": [
                {"q": "ما المنطقة المنخفضة الواقعة في منطقة وادي الأردن؟", "a": ["غور الأردن", "غور"]},
                {"q": "ما الحيوان الصحراوي رشيق الحركة ويشتهر بجمال قرنيه وسرعته؟", "a": ["غزال"]},
                {"q": "ما الدولة الإفريقية التي تقع عاصمتها في مدينة كوناكري؟", "a": ["غينيا"]},
                {"q": "ما الطائر الذي يتميز بلونه الأسود وصوته المميز؟", "a": ["غراب"]},
                {"q": "ما المدينة الأندلسية التي كانت آخر معاقل المسلمين في شبه الجزيرة الإيبيرية؟", "a": ["غرناطة", "غرناطه"]}
            ],
            "ف": [
                {"q": "ما الدولة الأوروبية التي عاصمتها هلسنكي؟", "a": ["فنلندا"]},
                {"q": "ما الدولة الأوروبية التي عاصمتها باريس؟", "a": ["فرنسا"]},
                {"q": "ما الحيوان البري الأكبر حجما في إفريقيا؟", "a": ["فيل"]},
                {"q": "ما الحيوان الذي يعد الأسرع في العدو بين السنوريات؟", "a": ["فهد"]},
                {"q": "ما الإمبراطورية التي امتدت في إيران قبل الإسلام؟", "a": ["فارس"]}
            ],
            "ق": [
                {"q": "ما الدولة العربية التي تقع على الخليج وعاصمتها الدوحة؟", "a": ["قطر"]},
                {"q": "ما هي عاصمة مصر؟", "a": ["قاهرة", "القاهرة"]},
                {"q": "ما المدينة الجزائرية التي تعرف بجسورها المعلقة؟", "a": ["قسنطينة"]},
                {"q": "ما القارة الأكبر من حيث المساحة والسكان؟", "a": ["قارة آسيا", "آسيا", "اسيا"]},
                {"q": "ما الكائن البحري الهلامي الذي قد يسبب لسعات مؤلمة؟", "a": ["قنديل البحر", "قنديل"]}
            ],
            "ك": [
                {"q": "ما هي عاصمة ماليزيا؟", "a": ["كوالالمبور", "كوالا لامبور"]},
                {"q": "ما هي عاصمة أفغانستان؟", "a": ["كابول"]},
                {"q": "ما هي عاصمة أوكرانيا؟", "a": ["كييف"]},
                {"q": "ما هي عاصمة أوغندا؟", "a": ["كمبالا"]},
                {"q": "ما البناء المقدس في مكة المكرمة الذي يتجه إليه المسلمون في صلاتهم؟", "a": ["كعبة", "الكعبة"]}
            ],
            "ل": [
                {"q": "ما اسم العملة الرسمية في لبنان؟", "a": ["ليرة لبنانية", "ليرة"]},
                {"q": "ما الفاكهة التي يكون لونها أصفر وتستخدم في العصائر؟", "a": ["ليمون"]},
                {"q": "ما الجزء الخارجي من الشجرة الذي يحميها؟", "a": ["لحاء"]},
                {"q": "ما الأداة التي تستخدم للكتابة على السبورة؟", "a": ["لوح الكتابة", "لوح"]},
                {"q": "ما العنصر الكيميائي الذي يرمز له بالرمز Li؟", "a": ["ليثيوم"]}
            ],
            "م": [
                {"q": "ما العضو في جسم الإنسان الذي يتحكم في الوظائف الحيوية للجسم؟", "a": ["مخ"]},
                {"q": "ما الشركة التي تصنع سيارات مرسيدس بنز؟", "a": ["مرسيدس-بنز", "مرسيدس بنز", "مرسيدس"]},
                {"q": "ما العضو في جسم الإنسان الذي يساعد في التنسيق بين الحواس والحركة؟", "a": ["مخيخ"]},
                {"q": "ما الجهاز الذي يستخدم في الزراعة لحفر الأرض؟", "a": ["محراث"]},
                {"q": "ما العضو الذي يساعد في هضم الطعام؟", "a": ["معدة", "المعدة"]}
            ],
            "ن": [
                {"q": "ما أكبر نهر في العالم من حيث طول مجراه؟", "a": ["نيل", "النيل"]},
                {"q": "ما الطائر الذي يرمز إلى الحرية ويشبه النسر؟", "a": ["نسر"]},
                {"q": "ما الحيوان الذي يعتبر رمزا للقوة في بعض الثقافات ويشبه النمر؟", "a": ["نمر"]},
                {"q": "ما الضوء الذي يشع من الشمس ويعتبر أساس الحياة على الأرض؟", "a": ["نور"]},
                {"q": "ما المادة المالية المستخدمة في المعاملات اليومية؟", "a": ["نقود"]}
            ],
            "ه": [
                {"q": "ما منطقة الترفيه السينمائي الشهيرة في كاليفورنيا؟", "a": ["هوليوود"]},
                {"q": "من المغني المصري الشهير الذي يشتهر بأغانيه الرومانسية؟", "a": ["هاني شاكر"]},
                {"q": "ما العلامة التجارية العالمية للأزياء؟", "a": ["هيرميس"]},
                {"q": "من الإله اليوناني الذي يعتبر رسول الآلهة؟", "a": ["هيرميس"]},
                {"q": "ما سلسلة الكتب الشهيرة عن ساحر شاب؟", "a": ["هاري بوتر"]}
            ],
            "و": [
                {"q": "ما اسم المسلسل التلفزيوني الأمريكي الشهير الذي يتناول حياة مجموعة من الشباب؟", "a": ["ويندسر"]},
                {"q": "ما اسم الرواية الشهيرة للكاتب الروسي فيودور دوستويفسيك؟", "a": ["وداع الأمة", "وداع للأمة"]},
                {"q": "من الفنان البريطاني الشهير الذي اشتهر بأغانيه الروك؟", "a": ["ويتني هيوستن"]},
                {"q": "ما اسم اللعبة الإلكترونية الشهيرة التي تدور حول بناء وتطوير المدن؟", "a": ["وورلد أوف واركرافت", "ورلد اوف وار كرافت"]},
                {"q": "ما اسم المسرحية الشهيرة التي كتبها أوسكار وايلد؟", "a": ["وداع يا جولييت", "وداعا يا جولييت"]}
            ],
            "ي": [
                {"q": "ما الفترة الزمنية التي تبلغ 24 ساعة؟", "a": ["يوم"]},
                {"q": "ما العضو في الجسم المستخدم للمس والإمساك؟", "a": ["يد"]},
                {"q": "ما الشعور بالثقة التامة دون شك؟", "a": ["يقين"]},
                {"q": "ما الاتجاه المعاكس لليمين؟", "a": ["يسار"]},
                {"q": "ما الدولة العربية الواقعة في جنوب شبه الجزيرة العربية؟", "a": ["يمن", "اليمن"]}
            ]
        }
        
        # قائمة الحروف المتاحة
        self.letters = list(self.questions_db.keys())
        random.shuffle(self.letters)
        
        self.current_letter = None
        self.current_question_data = None
        self.used_questions = {letter: [] for letter in self.letters}

    def get_question(self):
        # اختيار الحرف بالتناوب
        letter_idx = self.current_q % len(self.letters)
        self.current_letter = self.letters[letter_idx]
        
        # اختيار سؤال عشوائي لم يتم استخدامه من هذا الحرف
        available_questions = [
            q for i, q in enumerate(self.questions_db[self.current_letter])
            if i not in self.used_questions[self.current_letter]
        ]
        
        # إذا استخدمنا كل الأسئلة، نعيد تعيين القائمة
        if not available_questions:
            self.used_questions[self.current_letter] = []
            available_questions = self.questions_db[self.current_letter]
        
        self.current_question_data = random.choice(available_questions)
        question_idx = self.questions_db[self.current_letter].index(self.current_question_data)
        self.used_questions[self.current_letter].append(question_idx)
        
        text = f"حرف: {self.current_letter}\n\n{self.current_question_data['q']}"
        hint = f"الإجابة تبدأ بحرف {self.current_letter}"
        
        return self.build_question_flex(text, hint)

    def check_answer(self, answer: str) -> bool:
        if not answer or not self.current_question_data:
            return False
        
        normalized = Config.normalize(answer)
        
        # التحقق من الإجابة مع الإجابات المقبولة
        for correct_answer in self.current_question_data["a"]:
            normalized_correct = Config.normalize(correct_answer)
            if normalized == normalized_correct:
                return True
        
        return False
