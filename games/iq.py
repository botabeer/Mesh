import random
from games.base import BaseGame
from config import Config


class IqGame(BaseGame):
    def __init__(self, db, theme: str = "light"):
        super().__init__(db, theme)
        self.game_name = "ذكاء"
        
        self.riddles = [
            {"q": "ما الشيء الذي يمشي بلا ارجل ويبكي بلا عيون", "a": ["السحاب", "الغيم", "سحاب", "غيم"]},
            {"q": "له راس ولكن لا عين له", "a": ["الدبوس", "المسمار", "دبوس", "مسمار"]},
            {"q": "شيء كلما زاد نقص", "a": ["العمر", "الوقت", "عمر", "وقت"]},
            {"q": "يكتب ولا يقرا ابدا", "a": ["القلم", "قلم"]},
            {"q": "له اسنان كثيره ولكنه لا يعض", "a": ["المشط", "مشط"]},
            {"q": "يوجد في الماء ولكن الماء يميته", "a": ["الملح", "ملح"]},
            {"q": "يتكلم بجميع اللغات دون ان يتعلمها", "a": ["الصدي", "صدي"]},
            {"q": "شيء كلما اخذت منه كبر", "a": ["الحفره", "حفره"]},
            {"q": "يخترق الزجاج ولا يكسره", "a": ["الضوء", "النور", "ضوء", "نور"]},
            {"q": "يسمع بلا اذن ويتكلم بلا لسان", "a": ["الهاتف", "الجوال", "هاتف", "جوال"]},
            {"q": "له عنق بلا راس", "a": ["الزجاجه", "زجاجه"]},
            {"q": "ما هو الشيء الذي يقرصك ولا تراه", "a": ["الجوع", "جوع"]},
            {"q": "شيء موجود في السماء اذا اضفت له حرفا اصبح في الارض", "a": ["نجم", "نجوم"]},
            {"q": "ما هو الشيء الذي له اربع ارجل ولا يستطيع المشي", "a": ["الكرسي", "الطاوله", "كرسي", "طاوله", "السرير", "سرير"]},
            {"q": "شيء يرتفع ولا ينزل ابدا", "a": ["العمر", "عمر"]},
            {"q": "بيت بلا ابواب ولا نوافذ", "a": ["البيضه", "بيضه"]},
            {"q": "شيء اذا اكلته كله تستفيد واذا اكلت نصفه تموت", "a": ["السمسم", "سمسم"]},
            {"q": "شيء يجري ولا يمشي", "a": ["الماء", "ماء", "النهر", "نهر"]},
            {"q": "شيء له اذن ولا يسمع", "a": ["الكوب", "الفنجان", "كوب", "فنجان"]},
            {"q": "شيء يمكن كسره دون ان تلمسه", "a": ["الوعد", "وعد", "القلب", "قلب"]},
            {"q": "اخوان لا يرى احدهما الاخر", "a": ["الليل والنهار", "الليل", "النهار", "ليل", "نهار"]},
            {"q": "ما هو الشيء الذي يحملك وانت تحمله", "a": ["الحذاء", "حذاء", "النعل", "نعل"]},
            {"q": "شيء له وجه واحد ولكن ليس له جسم", "a": ["المراه", "المرآه", "مراه", "مرآه"]},
            {"q": "ما هو الشيء الذي يبقى ثابتا مهما سخن", "a": ["الفلفل", "فلفل"]},
            {"q": "حامل ومحمول نصفه ناشف ونصفه مبلول", "a": ["السفينه", "سفينه", "المركب", "مركب"]},
            {"q": "من هو الخال الوحيد لاولاد عمتك", "a": ["ابوك", "والدك", "ابي", "والدي", "الاب", "الوالد"]},
            {"q": "شيء له اربع ارجل في الصباح واثنين في الظهر وثلاثه في المساء", "a": ["الانسان", "انسان"]},
            {"q": "ما هو الشيء الذي يوجد في وسط باريس", "a": ["حرف الراء", "الراء", "راء", "ر"]},
            {"q": "شيء اسمه مثل لونه", "a": ["البيض", "البيضه", "بيض", "بيضه"]},
            {"q": "ما هو الشيء الذي تاكله بعد طبخه", "a": ["الطعام", "الاكل", "طعام", "اكل"]},
            {"q": "شيء كلما ازددت منه خف", "a": ["الثقوب", "الحفر", "ثقوب", "حفر"]},
            {"q": "ما هو الشيء الذي يكون اخضر في الارض واسود في السوق واحمر في البيت", "a": ["الشاي", "شاي"]},
            {"q": "شيء له رقبه بلا راس", "a": ["القميص", "قميص", "الزجاجه", "زجاجه"]},
            {"q": "ما هو الشيء الذي يمشي ويقف وليس له ارجل", "a": ["الساعه", "ساعه"]},
            {"q": "شيء اذا لمسته صاح", "a": ["الجرس", "جرس"]},
            {"q": "ما هو الشيء الذي يسير امامك ولا تراه", "a": ["المستقبل", "مستقبل", "الغد", "غد"]},
            {"q": "شيء يطير بلا جناح", "a": ["الدخان", "دخان", "السحاب", "سحاب"]},
            {"q": "ما هو الشيء الذي له راس واحد وثلاث ارجل", "a": ["العصا", "عصا"]},
            {"q": "شيء ترميه كلما احتجت اليه", "a": ["الشبكه", "شبكه", "السناره", "سناره"]},
            {"q": "ما هو الشيء الذي يكبر بالضرب", "a": ["الطبل", "طبل"]},
            {"q": "شيء له فروع ولا اوراق له", "a": ["البنك", "بنك"]},
            {"q": "ما هو الشيء الذي يجري بلا ارجل ويدخل الاذن بلا استئذان", "a": ["الصوت", "صوت"]},
            {"q": "شيء موجود في السنه مره واليوم مره والدقيقه مرتين", "a": ["حرف النون", "النون", "نون", "ن"]},
            {"q": "ما هو الشيء الذي له قلب ولا يخفق", "a": ["الشجره", "شجره"]},
            {"q": "شيء اذا غليته جمد", "a": ["البيض", "بيض"]},
            {"q": "ما هو الشيء الذي يمشي بقدميه ويعمل براسه", "a": ["المسمار", "مسمار"]},
            {"q": "شيء له رجل ولا يمشي", "a": ["الجبل", "جبل", "الطاوله", "طاوله"]},
            {"q": "ما هو الشيء الذي تراه في الليل ثلاث مرات وفي النهار مره", "a": ["حرف اللام", "اللام", "لام", "ل"]},
            {"q": "شيء يستحيل كسره", "a": ["المنخل", "منخل", "الغربال", "غربال"]},
            {"q": "ما هو الشيء الذي ليس له بدايه ولا نهايه", "a": ["الدائره", "دائره", "الحلقه", "حلقه"]}
        ]
        random.shuffle(self.riddles)
        self.used_riddles = []
    
    def get_question(self):
        available = [r for r in self.riddles if r not in self.used_riddles]
        if not available:
            self.used_riddles = []
            available = self.riddles.copy()
        
        riddle = random.choice(available)
        self.used_riddles.append(riddle)
        self.current_answer = riddle["a"]
        
        hint = "لغز ذكاء"
        return self.build_question_flex(riddle["q"], hint)
    
    def check_answer(self, answer: str) -> bool:
        normalized = Config.normalize(answer)
        return any(Config.normalize(a) == normalized for a in self.current_answer)
