"""
ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ - Bot Mesh v9.1 FIXED
Created by: Abeer Aldosari Â© 2025
âœ… ÙØ±Ø¯ÙŠ: Ù„Ù…Ø­ + Ø¬Ø§ÙˆØ¨ + Ù…Ø¤Ù‚Øª
âœ… ÙØ±ÙŠÙ‚ÙŠÙ†: Ù…Ø¤Ù‚Øª ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø­/Ø¬Ø§ÙˆØ¨)
"""

from games.base_game import BaseGame
import random
import time
from typing import Dict, Any, Optional


class IqGame(BaseGame):
    """Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ - Ø£Ù„ØºØ§Ø² Ø°ÙƒÙŠØ©"""

    def __init__(self, line_bot_api):
        super().__init__(line_bot_api, questions_count=5)
        self.game_name = "Ø°ÙƒØ§Ø¡"
        self.game_icon = "ğŸ§ "
        self.supports_hint = True
        self.supports_reveal = True

        self.round_time = 30  # â±ï¸ 30 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„
        self.round_start_time = None
        
        # Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ù„ØºØ§Ø² - 60+ Ù„ØºØ²
        self.riddles = [
            {"q": "Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø´ÙŠ Ø¨Ù„Ø§ Ø£Ø±Ø¬Ù„ ÙˆÙŠØ¨ÙƒÙŠ Ø¨Ù„Ø§ Ø¹ÙŠÙˆÙ†ØŸ", "a": ["Ø§Ù„Ø³Ø­Ø§Ø¨", "Ø§Ù„ØºÙŠÙ…", "Ø³Ø­Ø§Ø¨", "ØºÙŠÙ…"]},
            {"q": "Ù„Ù‡ Ø±Ø£Ø³ ÙˆÙ„ÙƒÙ† Ù„Ø§ Ø¹ÙŠÙ† Ù„Ù‡ØŸ", "a": ["Ø§Ù„Ø¯Ø¨ÙˆØ³", "Ø§Ù„Ù…Ø³Ù…Ø§Ø±", "Ø§Ù„Ø¥Ø¨Ø±Ø©", "Ø¯Ø¨ÙˆØ³", "Ù…Ø³Ù…Ø§Ø±", "Ø§Ø¨Ø±Ø©"]},
            {"q": "Ø´ÙŠØ¡ ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ù†Ù‚ØµØŸ", "a": ["Ø§Ù„Ø¹Ù…Ø±", "Ø§Ù„ÙˆÙ‚Øª", "Ø¹Ù…Ø±", "ÙˆÙ‚Øª"]},
            {"q": "ÙŠÙƒØªØ¨ ÙˆÙ„Ø§ ÙŠÙ‚Ø±Ø£ Ø£Ø¨Ø¯Ø§Ù‹ØŸ", "a": ["Ø§Ù„Ù‚Ù„Ù…", "Ù‚Ù„Ù…"]},
            {"q": "Ù„Ù‡ Ø£Ø³Ù†Ø§Ù† ÙƒØ«ÙŠØ±Ø© ÙˆÙ„ÙƒÙ†Ù‡ Ù„Ø§ ÙŠØ¹Ø¶ØŸ", "a": ["Ø§Ù„Ù…Ø´Ø·", "Ù…Ø´Ø·"]},
            {"q": "ÙŠÙˆØ¬Ø¯ ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù…Ø§Ø¡ ÙŠÙ…ÙŠØªÙ‡ØŸ", "a": ["Ø§Ù„Ù…Ù„Ø­", "Ù…Ù„Ø­"]},
            {"q": "ÙŠØªÙƒÙ„Ù… Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„ØºØ§Øª Ø¯ÙˆÙ† Ø£Ù† ÙŠØªØ¹Ù„Ù…Ù‡Ø§ØŸ", "a": ["Ø§Ù„ØµØ¯Ù‰", "ØµØ¯Ù‰"]},
            {"q": "Ø´ÙŠØ¡ ÙƒÙ„Ù…Ø§ Ø£Ø®Ø°Øª Ù…Ù†Ù‡ ÙƒØ¨Ø±ØŸ", "a": ["Ø§Ù„Ø­ÙØ±Ø©", "Ø­ÙØ±Ø©"]},
            {"q": "ÙŠØ®ØªØ±Ù‚ Ø§Ù„Ø²Ø¬Ø§Ø¬ ÙˆÙ„Ø§ ÙŠÙƒØ³Ø±Ù‡ØŸ", "a": ["Ø§Ù„Ø¶ÙˆØ¡", "Ø§Ù„Ù†ÙˆØ±", "Ø¶ÙˆØ¡", "Ù†ÙˆØ±"]},
            {"q": "ÙŠØ³Ù…Ø¹ Ø¨Ù„Ø§ Ø£Ø°Ù† ÙˆÙŠØªÙƒÙ„Ù… Ø¨Ù„Ø§ Ù„Ø³Ø§Ù†ØŸ", "a": ["Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„Ø¬ÙˆØ§Ù„", "Ù‡Ø§ØªÙ", "Ø¬ÙˆØ§Ù„"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ØªØ±Ø§Ù‡ ÙˆÙ„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ù„Ù…Ø³Ù‡ØŸ", "a": ["Ø§Ù„Ø¸Ù„", "Ø¸Ù„"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø´ÙŠ Ø¨Ù„Ø§ Ù‚Ø¯Ù…ÙŠÙ†ØŸ", "a": ["Ø§Ù„ÙˆÙ‚Øª", "ÙˆÙ‚Øª", "Ø§Ù„Ø²Ù…Ù†"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø¯Ø®Ù„ Ø§Ù„Ù…Ø§Ø¡ Ù„Ø§ ÙŠØ¨ØªÙ„ØŸ", "a": ["Ø§Ù„Ø¶ÙˆØ¡", "Ø¶ÙˆØ¡"]},
            {"q": "Ù„Ù‡ Ø¹ÙŠÙ†Ø§Ù† ÙˆÙ„Ø§ ÙŠØ±Ù‰ØŸ", "a": ["Ø§Ù„Ù…Ù‚Øµ", "Ù…Ù‚Øµ"]},
            {"q": "Ø£Ø®Ø¶Ø± ÙÙŠ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ£Ø³ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ£Ø­Ù…Ø± ÙÙŠ Ø§Ù„Ø¨ÙŠØªØŸ", "a": ["Ø§Ù„Ø´Ø§ÙŠ", "Ø´Ø§ÙŠ"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙ…Ø´ÙŠ Ø¥Ù„Ø§ Ø¨Ø§Ù„Ø¶Ø±Ø¨ØŸ", "a": ["Ø§Ù„Ù…Ø³Ù…Ø§Ø±", "Ù…Ø³Ù…Ø§Ø±"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ù‚Ø·Ø¹ØªÙ‡ ÙƒØ¨Ø±ØŸ", "a": ["Ø§Ù„Ø­Ø¨Ù„", "Ø­Ø¨Ù„"]},
            {"q": "Ù„Ù‡ Ø£ÙˆØ±Ø§Ù‚ ÙˆÙ„ÙŠØ³ Ø´Ø¬Ø±Ø§Ù‹ØŸ", "a": ["Ø§Ù„ÙƒØªØ§Ø¨", "ÙƒØªØ§Ø¨"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ‚Ø±ØµÙƒ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ØŸ", "a": ["Ø§Ù„Ø¬ÙˆØ¹", "Ø¬ÙˆØ¹"]},
            {"q": "ÙŠÙ…ØªÙ„Ø¦ Ø¨Ø§Ù„Ø«Ù‚ÙˆØ¨ ÙˆÙŠØ­ÙØ¸ Ø§Ù„Ù…Ø§Ø¡ØŸ", "a": ["Ø§Ù„Ø¥Ø³ÙÙ†Ø¬", "Ø§Ø³ÙÙ†Ø¬"]},
            {"q": "ÙŠØ³ÙŠØ± Ø¨Ù„Ø§ Ù‚Ø¯Ù…ÙŠÙ† ÙˆÙŠØ¯Ø®Ù„ Ø§Ù„Ø£Ø°Ù†ÙŠÙ†ØŸ", "a": ["Ø§Ù„ØµÙˆØª", "ØµÙˆØª"]},
            {"q": "ÙŠÙˆÙ„Ø¯ ÙƒØ¨ÙŠØ±Ø§Ù‹ ÙˆÙŠÙ…ÙˆØª ØµØºÙŠØ±Ø§Ù‹ØŸ", "a": ["Ø§Ù„Ø´Ù…Ø¹Ø©", "Ø´Ù…Ø¹Ø©"]},
            {"q": "Ù„Ù‡ Ø±Ù‚Ø¨Ø© ÙˆÙ„ÙŠØ³ Ù„Ù‡ Ø±Ø£Ø³ØŸ", "a": ["Ø§Ù„Ø²Ø¬Ø§Ø¬Ø©", "Ø²Ø¬Ø§Ø¬Ø©"]},
            {"q": "ØªØ³ØªØ·ÙŠØ¹ ÙƒØ³Ø±Ù‡ Ø¯ÙˆÙ† Ù„Ù…Ø³Ù‡ØŸ", "a": ["Ø§Ù„ÙˆØ¹Ø¯", "ÙˆØ¹Ø¯"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø§Ù… ÙˆÙ„Ø§ ÙŠØ³ØªÙŠÙ‚Ø¸ØŸ", "a": ["Ø§Ù„Ù…ÙˆØª", "Ù…ÙˆØª"]},
            {"q": "Ø£Ø¨ÙŠØ¶ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ ÙˆØ£Ø³ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±ØŸ", "a": ["Ø§Ù„Ø·Ø±ÙŠÙ‚", "Ø·Ø±ÙŠÙ‚"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠØªÙƒÙ„Ù… ÙˆÙ„ÙƒÙ† Ø¥Ø°Ø§ Ø¶Ø±Ø¨ØªÙ‡ ØµØ§Ø­ØŸ", "a": ["Ø§Ù„Ø¬Ø±Ø³", "Ø¬Ø±Ø³"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø³Ù…ÙŠØªÙ‡ ÙƒØ³Ø±ØŸ", "a": ["Ø§Ù„ØµÙ…Øª", "ØµÙ…Øª"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ØªØ°Ø¨Ø­Ù‡ ÙˆØªØ¨ÙƒÙŠ Ø¹Ù„ÙŠÙ‡ØŸ", "a": ["Ø§Ù„Ø¨ØµÙ„", "Ø¨ØµÙ„"]},
            {"q": "ÙŠØ·ÙŠØ± Ø¨Ù„Ø§ Ø£Ø¬Ù†Ø­Ø©ØŸ", "a": ["Ø§Ù„ÙˆÙ‚Øª", "ÙˆÙ‚Øª", "Ø§Ù„Ø²Ù…Ù†"]},
            {"q": "ÙŠØ³ÙŠØ± Ø¨Ù„Ø§ Ø¹ÙŠÙˆÙ†ØŸ", "a": ["Ø§Ù„Ù…Ø§Ø¡", "Ù…Ø§Ø¡"]},
            {"q": "ÙŠØ£ÙƒÙ„ ÙˆÙ„Ø§ ÙŠØ´Ø¨Ø¹ØŸ", "a": ["Ø§Ù„Ù†Ø§Ø±", "Ù†Ø§Ø±"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ØªØ±Ø§Ù‡ ÙˆÙ„Ø§ ØªÙ…Ø³ÙƒÙ‡ØŸ", "a": ["Ø§Ù„Ù‡ÙˆØ§Ø¡", "Ù‡ÙˆØ§Ø¡"]},
            {"q": "Ù„Ù‡ Ù…ÙØªØ§Ø­ ÙˆÙ„Ø§ ÙŠÙØªØ­ØŸ", "a": ["Ø§Ù„Ø¨ÙŠØ§Ù†Ùˆ", "Ø¨ÙŠØ§Ù†Ùˆ"]},
            {"q": "ÙŠØªØ­Ø±Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø­ÙˆÙ„Ùƒ ÙˆÙ„Ø§ ØªØ´Ø¹Ø± Ø¨Ù‡ØŸ", "a": ["Ø§Ù„Ù‡ÙˆØ§Ø¡", "Ù‡ÙˆØ§Ø¡"]},
            {"q": "ÙŠÙØ±Ù‰ ÙˆÙ„Ø§ ÙŠÙÙ…Ø³ØŸ", "a": ["Ø§Ù„Ø¸Ù„", "Ø¸Ù„"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙƒÙ„Ù…Ø§ ÙƒØ¨Ø± ØµØºØ±ØŸ", "a": ["Ø§Ù„Ø¹Ù…Ø±", "Ø¹Ù…Ø±"]},
            {"q": "Ù„Ù‡ ÙŠØ¯ ÙˆØ§Ø­Ø¯Ø© ÙˆÙ„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØµÙÙŠÙ‚ØŸ", "a": ["Ø§Ù„Ø³Ø§Ø¹Ø©", "Ø³Ø§Ø¹Ø©"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù„Ù‡ Ø£Ø±Ø¨Ø¹ Ø£Ø±Ø¬Ù„ ÙˆÙ„Ø§ ÙŠÙ…Ø´ÙŠØŸ", "a": ["Ø§Ù„ÙƒØ±Ø³ÙŠ", "ÙƒØ±Ø³ÙŠ", "Ø§Ù„Ø·Ø§ÙˆÙ„Ø©", "Ø·Ø§ÙˆÙ„Ø©"]},
            {"q": "ÙŠØµØ¹Ø¯ ÙˆÙ„Ø§ ÙŠÙ†Ø²Ù„ØŸ", "a": ["Ø§Ù„Ø¹Ù…Ø±", "Ø¹Ù…Ø±", "Ø§Ù„Ø³Ù„Ù…"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø¨Ø¶ Ø¨Ù„Ø§ Ù‚Ù„Ø¨ØŸ", "a": ["Ø§Ù„Ø³Ø§Ø¹Ø©", "Ø³Ø§Ø¹Ø©"]},
            {"q": "Ù„Ù‡ ÙÙ… ÙˆÙ„Ø§ ÙŠØªÙƒÙ„Ù…ØŸ", "a": ["Ø§Ù„Ù†Ù‡Ø±", "Ù†Ù‡Ø±", "Ø§Ù„ÙˆØ§Ø¯ÙŠ"]},
            {"q": "ÙŠØ¬Ø±ÙŠ ÙˆÙ„Ø§ ÙŠÙ…Ø´ÙŠØŸ", "a": ["Ø§Ù„Ù…Ø§Ø¡", "Ù…Ø§Ø¡", "Ø§Ù„Ù†Ù‡Ø±"]},
            {"q": "ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ù…ÙŠÙ‡ ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙ‚Ø§Ø·Ù‡ØŸ", "a": ["Ø§Ù„Ø±ÙŠØ´", "Ø±ÙŠØ´"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙƒÙ„Ù…Ø§ Ø£Ø¹Ø·ÙŠØªÙ‡ ÙƒÙ„Ù…Ø§ Ø£Ø®Ø° Ù…Ù†ÙƒØŸ", "a": ["Ø§Ù„Ø³Ø±", "Ø³Ø±"]},
            {"q": "Ù„Ù‡ Ø°ÙŠÙ„ ÙˆÙ„ÙƒÙ† Ù„Ø§ Ø¬Ø³Ø¯ Ù„Ù‡ØŸ", "a": ["Ø§Ù„Ø¹Ù…Ù„Ø©", "Ø¹Ù…Ù„Ø©"]},
            {"q": "ÙŠÙ…Ù„Ø£ Ø§Ù„ØºØ±ÙØ© ÙˆÙ„Ø§ ÙŠØ´ØºÙ„ Ø­ÙŠØ²Ø§Ù‹ØŸ", "a": ["Ø§Ù„Ø¶ÙˆØ¡", "Ø¶ÙˆØ¡", "Ø§Ù„Ù‡ÙˆØ§Ø¡"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù„Ù‡ Ù‚Ù„Ø¨ ÙˆÙ„ÙƒÙ† Ù„Ø§ Ø£Ø¹Ø¶Ø§Ø¡ Ø£Ø®Ø±Ù‰ØŸ", "a": ["Ø§Ù„Ø´Ø¬Ø±Ø©", "Ø´Ø¬Ø±Ø©"]},
            {"q": "Ù„Ù‡ Ø¬Ø°ÙˆØ± Ù„Ø§ ÙŠØ±Ø§Ù‡Ø§ Ø£Ø­Ø¯ØŸ", "a": ["Ø§Ù„Ø´Ø¬Ø±Ø©", "Ø´Ø¬Ø±Ø©"]},
            {"q": "ÙŠØ±ØªÙØ¹ ÙˆÙ„Ø§ ÙŠØ³Ù‚Ø· Ø£Ø¨Ø¯Ø§Ù‹ØŸ", "a": ["Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø¯Ø®Ø§Ù†"]},
            {"q": "Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø·Ø§Ø¦Ù‡ Ù„Ø´Ø®Øµ Ø¢Ø®Ø±ØŸ", "a": ["Ø§Ù„ÙƒÙ„Ù…Ø©", "ÙƒÙ„Ù…Ø©", "Ø§Ù„ÙˆØ¹Ø¯"]},
            {"q": "ÙŠÙ‚Ù Ø£Ù…Ø§Ù…Ùƒ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ØŸ", "a": ["Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„", "Ù…Ø³ØªÙ‚Ø¨Ù„"]},
            {"q": "Ù„Ù‡ Ø¹ÙŠÙ† ÙˆÙ„Ø§ ÙŠØ¨ÙƒÙŠØŸ", "a": ["Ø§Ù„Ø¥Ø¨Ø±Ø©", "Ø§Ø¨Ø±Ø©"]},
            {"q": "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† Ù‚Ø·Ø¹Ù‡ ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙ†Ù‚Ø³Ù…ØŸ", "a": ["Ø§Ù„Ù…Ø§Ø¡", "Ù…Ø§Ø¡"]},
            {"q": "Ù„Ù‡ ÙˆØ¬Ù‡ ÙˆÙ„ÙƒÙ† Ù„Ø§ Ø¹ÙŠÙˆÙ† Ø£Ùˆ ÙÙ… Ø£Ùˆ Ø£Ù†ÙØŸ", "a": ["Ø§Ù„Ø³Ø§Ø¹Ø©", "Ø³Ø§Ø¹Ø©", "Ø§Ù„Ù‚Ù…Ø±"]},
            {"q": "ÙŠØ±ÙƒØ¶ ÙˆÙ„Ø§ ÙŠØªØ¹Ø¨ØŸ", "a": ["Ø§Ù„Ù†Ù‡Ø±", "Ù†Ù‡Ø±", "Ø§Ù„Ù…Ø§Ø¡"]},
            {"q": "Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠØ°Ù‡Ø¨ ØµØ¹ÙˆØ¯Ø§Ù‹ ÙˆÙ‡Ø¨ÙˆØ·Ø§Ù‹ Ø¯ÙˆÙ† Ø£Ù† ÙŠØªØ­Ø±ÙƒØŸ", "a": ["Ø§Ù„Ø¯Ø±Ø¬", "Ø¯Ø±Ø¬", "Ø§Ù„Ø³Ù„Ù…"]},
            {"q": "Ù„Ù‡ Ø£Ø°Ù†Ø§Ù† ÙˆÙ„Ø§ ÙŠØ³Ù…Ø¹ØŸ", "a": ["Ø§Ù„Ø¥Ø¨Ø±ÙŠÙ‚", "Ø§Ø¨Ø±ÙŠÙ‚", "Ø§Ù„ÙƒÙˆØ¨"]},
            {"q": "ÙŠØ¨Ø¯Ø£ ÙˆÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø­Ø±Ù ÙˆØ§Ø­Ø¯ ÙˆÙ„Ù‡ Ø­Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŸ", "a": ["Ø§Ù„Ø¹ÙŠÙ†", "Ø¹ÙŠÙ†"]}
        ]

        random.shuffle(self.riddles)
        self.used_riddles = []

    def start_game(self):
        self.current_question = 0
        self.game_active = True
        self.used_riddles = []
        self.previous_question = None
        self.previous_answer = None
        self.answered_users.clear()
        return self.get_question()

    def get_question(self):
        # Ø§Ø®ØªÙŠØ§Ø± Ù„ØºØ² Ø¬Ø¯ÙŠØ¯
        available = [r for r in self.riddles if r not in self.used_riddles]
        if not available:
            self.used_riddles = []
            available = self.riddles.copy()

        riddle = random.choice(available)
        self.used_riddles.append(riddle)
        self.current_answer = riddle["a"]
        
        # Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
        self.round_start_time = time.time()

        # âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… can_use_hint() Ùˆ can_reveal_answer()
        if self.can_use_hint() and self.can_reveal_answer():
            additional_info = f"â±ï¸ {self.round_time} Ø«Ø§Ù†ÙŠØ©\nğŸ’¡ Ø§ÙƒØªØ¨ 'Ù„Ù…Ø­' Ø£Ùˆ 'Ø¬Ø§ÙˆØ¨'"
        else:
            additional_info = f"â±ï¸ {self.round_time} Ø«Ø§Ù†ÙŠØ©"

        return self.build_question_flex(
            question_text=f"ğŸ§© {riddle['q']}",
            additional_info=additional_info
        )

    def _time_expired(self) -> bool:
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª"""
        if not self.round_start_time:
            return False
        return (time.time() - self.round_start_time) > self.round_time

    def check_answer(self, user_answer: str, user_id: str, display_name: str) -> Optional[Dict[str, Any]]:
        if not self.game_active:
            return None

        # âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø£ÙˆÙ„Ø§Ù‹
        if self._time_expired():
            answers_text = " Ø£Ùˆ ".join(self.current_answer)
            self.current_question += 1
            self.answered_users.clear()

            if self.current_question >= self.questions_count:
                result = self.end_game()
                result["message"] = f"â±ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {answers_text}\n\n{result.get('message', '')}"
                return result

            return {
                "message": f"â±ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {answers_text}",
                "response": self.get_question(),
                "points": 0
            }

        # ØªØ¬Ø§Ù‡Ù„ Ù…Ù† Ø£Ø¬Ø§Ø¨
        if user_id in self.answered_users:
            return None
        
        # ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ†: ØªØ¬Ø§Ù‡Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù†Ø¶Ù…ÙŠÙ†
        if self.team_mode and user_id not in self.joined_users:
            return None

        normalized = self.normalize_text(user_answer)

        # âœ… Ø§Ù„ØªÙ„Ù…ÙŠØ­ (ÙØ±Ø¯ÙŠ ÙÙ‚Ø·)
        if self.can_use_hint() and normalized == "Ù„Ù…Ø­":
            if not self.current_answer:
                return {
                    "message": "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ„Ù…ÙŠØ­Ø§Øª",
                    "response": self._create_text_message("Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ„Ù…ÙŠØ­Ø§Øª"),
                    "points": 0
                }
            
            answer = self.current_answer[0]
            if len(answer) <= 2:
                hint = f"ğŸ’¡ Ø§Ù„ÙƒÙ„Ù…Ø© Ù‚ØµÙŠØ±Ø©: {answer[0]}_"
            else:
                hint = f"ğŸ’¡ ØªÙ„Ù…ÙŠØ­: {answer[0]}{answer[1]}{'_' * (len(answer) - 2)}"
            
            return {
                "message": hint,
                "response": self._create_text_message(hint),
                "points": 0
            }

        # âœ… ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (ÙØ±Ø¯ÙŠ ÙÙ‚Ø·)
        if self.can_reveal_answer() and normalized == "Ø¬Ø§ÙˆØ¨":
            answers_text = " Ø£Ùˆ ".join(self.current_answer)
            self.current_question += 1
            self.answered_users.clear()

            if self.current_question >= self.questions_count:
                result = self.end_game()
                result["message"] = f"Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {answers_text}\n\n{result.get('message', '')}"
                return result

            return {
                "message": f"Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {answers_text}",
                "response": self.get_question(),
                "points": 0
            }

        # âœ… ØªØ¬Ø§Ù‡Ù„ Ù„Ù…Ø­/Ø¬Ø§ÙˆØ¨ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† Ø¨Ø´ÙƒÙ„ ØµØ§Ù…Øª
        if self.team_mode and normalized in ["Ù„Ù…Ø­", "Ø¬Ø§ÙˆØ¨"]:
            return None

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        for correct in self.current_answer:
            if self.normalize_text(correct) == normalized:
                # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ø¹ Ø¨ÙˆÙ†Øµ Ø§Ù„ÙˆÙ‚Øª
                base_points = 10
                elapsed = int(time.time() - self.round_start_time)
                remaining = max(0, self.round_time - elapsed)
                time_bonus = max(0, remaining // 3)
                total_points = base_points + time_bonus

                # ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·
                if self.team_mode:
                    team = self.get_user_team(user_id)
                    if not team:
                        team = self.assign_to_team(user_id)
                    self.add_team_score(team, total_points)
                else:
                    self.add_score(user_id, display_name, total_points)

                self.previous_question = self.used_riddles[-1]["q"]
                self.previous_answer = correct

                self.current_question += 1
                self.answered_users.clear()

                if self.current_question >= self.questions_count:
                    result = self.end_game()
                    result["points"] = total_points
                    return result

                bonus_msg = f" +{time_bonus} Ø¨ÙˆÙ†Øµ ÙˆÙ‚Øª" if time_bonus > 0 else ""
                return {
                    "message": f"âœ… ØµØ­ÙŠØ­!\n+{total_points} Ù†Ù‚Ø·Ø©{bonus_msg}",
                    "response": self.get_question(),
                    "points": total_points
                }

        return {
            "message": "âŒ Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
            "response": self._create_text_message("âŒ Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©"),
            "points": 0
        }
