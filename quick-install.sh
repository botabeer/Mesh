#!/bin/bash
# Bot Mesh - Quick Install Script
# ููุฒูู ููุซุจูุช ุฌููุน ุงูุฃูุนุงุจ ุงููุญุณูุฉ ุชููุงุฆูุงู
# Created by: Abeer Aldosari ยฉ 2025

set -e

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ  ๐ฎ Bot Mesh - Quick Install      โ"
echo "โ  ุฌููุน ุงูุฃูุนุงุจ ุงููุญุณูุฉ            โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุงูุชุญุณููุงุช
cat << 'EOF'
โจ ุงูุชุญุณููุงุช ุงูุฌุฏูุฏุฉ:

โ ุชุตููู ููุญุฏ ูุฃููู ูุฌููุน ุงูุฃูุนุงุจ
โ ุฏุนู ูุงูู ููุซููุงุช (7 ุซููุงุช)
โ ุฑุณุงุฆู ุชูุงุนููุฉ ูููููุฉ
โ ุฃูุงูุฑ ููุญุฏุฉ (ููุญุ ุฌุงูุจ)
โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
โ ุฑุณุงุฆู ููุงูุฉ ุฌูููุฉ ูุน ุงููุชุงุฆุฌ
โ ุฏุนู ุงูุฃุฒุฑุงุฑ ุงูุซุงุจุชุฉ (Quick Reply)
โ ูุชูุงูู ูุน ุฒุฑ "ุงูุถู"

EOF

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุฅูุดุงุก ูุฌูุฏ games ุฅู ูู ููู ููุฌูุฏุงู
mkdir -p games
echo "โ ูุฌูุฏ games/ ุฌุงูุฒ"

# ุงูุทุฑููุฉ: ูุณุฎ ุงููููุงุช ุงูููุฌูุฏุฉ ูุชุญุฏูุซูุง

echo ""
echo "๐ ุฌุงุฑู ุชุญุฏูุซ ุงูุฃูุนุงุจ..."
echo ""

# ูุนุฏู ุงููููุงุช ุงูููุฌูุฏุฉ ููุท ุจุฅุถุงูุฉ ุงูุชุญุณููุงุช

# 1. ุชุญุฏูุซ base_game.py
if [ -f "games/base_game.py" ]; then
    echo "โก ุชุญุฏูุซ base_game.py..."
    # ุฅุถุงูุฉ ุฏุงูุฉ set_theme ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
    if ! grep -q "def set_theme" games/base_game.py; then
        # ุณูุถูู ุงูุฏุงูุฉ ุจุนุฏ __init__
        sed -i '/def __init__/,/self.created_at = datetime.now()/a\        self.theme = "white"' games/base_game.py
        sed -i '/def check_answer/i\    def set_theme(self, theme_name: str):\n        """ุชุนููู ุงูุซูู"""\n        self.theme = theme_name\n' games/base_game.py
    fi
    echo "โ base_game.py"
else
    echo "โ base_game.py ุบูุฑ ููุฌูุฏ"
fi

# 2. ุฅุตูุงุญ ุฑุณุงุฆู ููุงูุฉ ุงููุนุจุฉ
for game_file in games/*_game.py; do
    if [ -f "$game_file" ]; then
        filename=$(basename "$game_file")
        
        # ุฅุถุงูุฉ ุฑุณุงูุฉ "ุงุฎุชุฑ ูุนุจุฉ ุฃุฎุฑู" ูู ููุงูุฉ ุงูุฃูุนุงุจ
        if grep -q "ุงูุชูุช ุงููุนุจุฉ" "$game_file"; then
            if ! grep -q "ุงุฎุชุฑ ูุนุจุฉ ุฃุฎุฑู" "$game_file"; then
                # ุฅุถุงูุฉ ุงูุฑุณุงูุฉ
                sed -i 's/ุงูุชูุช ุงููุนุจุฉ!/ุงูุชูุช ุงููุนุจุฉ!\\n\\n๐ก ุงุฎุชุฑ ูุนุจุฉ ุฃุฎุฑู ูู ุงููุงุฆูุฉ ุฃุฏูุงู!/g' "$game_file"
            fi
        fi
        
        echo "โ $filename"
    fi
done

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ ุงูุชูู ุงูุชุญุฏูุซ!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุนุฑุถ ุงููููุงุช ุงููุญุฏุซุฉ
echo "๐ฆ ุงููููุงุช ุงููุญุฏุซุฉ:"
ls -1 games/*.py | while read file; do
    echo "  โ $(basename $file)"
done

echo ""
echo "๐ฎ ุงูุฃูุนุงุจ ุงููุชููุฑุฉ (12 ูุนุจุฉ):"
cat << 'EOF'
  1. ๐ง ุฐูุงุก - ุฃุณุฆูุฉ ุฐูุงุก
  2. ๐จ ููู - ุชุฃุซูุฑ Stroop
  3. ๐ค ุชุฑุชูุจ - ุชุฑุชูุจ ุงูุญุฑูู
  4. ๐ข ุฑูุงุถูุงุช - ุนูููุงุช ุญุณุงุจูุฉ
  5. โก ุฃุณุฑุน - ูุชุงุจุฉ ุณุฑูุนุฉ
  6. โ๏ธ ุถุฏ - ุงูุฃุถุฏุงุฏ
  7. โ๏ธ ุชูููู - ุชูููู ูููุงุช
  8. ๐ต ุฃุบููุฉ - ุชุฎููู ุงููุบูู
  9. ๐ฏ ูุนุจุฉ - ุฅูุณุงู ุญููุงู ูุจุงุช
  10. โ๏ธ ุณูุณูุฉ - ุณูุณูุฉ ุงููููุงุช
  11. ๐ค ุฎูู - ุงูุชุฎููู ุจุงููุฆุงุช
  12. ๐ ุชูุงูู - ุงูุชูุงูู ุจูู ุงูุฃุณูุงุก
EOF

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo ""
echo "1๏ธโฃ  ุงุฎุชุจุฑ ุงูุฃูุนุงุจ:"
echo "   python app.py"
echo ""
echo "2๏ธโฃ  ุชุญูู ูู ุนูู ุงูุจูุช:"
echo "   curl http://localhost:5000/health"
echo ""
echo "3๏ธโฃ  ุงุฎุชุจุฑ ูุนุจุฉ ูุนููุฉ ูู LINE"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ก ูุตูุญุฉ: ุงูุฃูุนุงุจ ุงูุขู ูุชูุงููุฉ ูุน:"
echo "   โข ุงูุฃุฒุฑุงุฑ ุงูุซุงุจุชุฉ (Quick Reply)"
echo "   โข ุฒุฑ ุงูุถู (ุจุฏูุงู ูู ุฅููุงู)"
echo "   โข ุฌููุน ุงูุซููุงุช (7 ุซููุงุช)"
echo ""
echo "โจ Created by: Abeer Aldosari ยฉ 2025"
echo ""
